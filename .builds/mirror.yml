image: alpine/3.14
secrets:
  - b08bdb04-b964-46c5-bf00-409b6ae32ad8
tasks:
  - clone: |
      git clone --mirror https://git.sr.ht/~xaerru/NVelox
  - add-host: |
      ssh-keyscan -t rsa -H github.com >> ~/.ssh/known_hosts
      echo enable-ssh-support >> $HOME/.gnupg/gpg-agent.conf
      echo 13E0B25F8DF3A7D0DAB55F4290D620BE5F61B7CF >> $HOME/.gnupg/sshcontrol
      unset SSH_AGENT_PID
      if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
        export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
      fi
      export GPG_TTY=$(tty)
      gpg-connect-agent updatestartuptty /bye >/dev/null
  - push: |
      cd NVelox.git
      git push --mirror git@github.com:xaerru/NVelox.git
